{"version":3,"sources":["components/logo.svg","components/Header.tsx","components/Footer.tsx","components/Loading.tsx","App.tsx","index.tsx","models/index.tsx","config.tsx","stores/history.tsx","stores/user.tsx","stores/image.tsx","stores/auth.tsx","stores/index.tsx"],"names":["HeaderWrapper","styled","header","Nav","nav","Logo","img","Header","observer","useStores","UserStore","AuthStore","src","logo","to","activeClassName","exact","currentUser","getUsername","onClick","logOut","HistoryStore","reset","FooterWrapper","footer","Footer","Loading","Home","lazy","History","About","SignIn","SignUp","Main","main","Wrapper","div","App","fallback","path","component","ReactDOM","render","document","getElementById","AV","init","config","leancloud","console","log","AuthModels","signUp","username","password","user","User","setUsername","setPassword","Promise","resolve","reject","then","signInUser","error","signIn","logIn","getCurrentUser","current","UploadModels","add","file","filename","item","Object","avFile","File","set","save","serverFile","reader","FileReader","readAsDataURL","onload","str","result","baseStr","slice","indexOf","length","name","dataImage","data","JSON","stringify","message","content","fetch","body","method","headers","response","catch","err","uploadGithub","id","e","find","page","limit","query","Query","include","skip","descending","equalTo","results","imageUrl","appId","appKey","serverURL","historyStore","list","isLoading","hasMore","append","newList","this","concat","map","x","idx","fileId","get","url","finally","makeAutoObservable","store","setCurrentUser","isUploading","setFilename","newFilename","setFile","newFile","upload","ImageStore","isSignIn","values","setIsSignIn","passWord","runInAction","defaultValue","Context","createContext","useContext"],"mappings":"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","file":"static/js/main.a1d8c4c1.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.507159fb.svg\";","import {observer} from 'mobx-react';\nimport {NavLink} from 'react-router-dom';\nimport {useStores} from 'stores';\nimport {HistoryStore} from 'stores/history';\nimport styled from 'styled-components';\nimport logo from './logo.svg';\n\nconst HeaderWrapper = styled.header`\n  background-color: #2f3133;\n  display: flex;\n  align-items: center;\n  padding: 10px 100px;\n  justify-content: space-between;\n  > div {\n    color: #ffffff;\n    > button,\n    a {\n      margin-left: 10px;\n      border: 1px solid #ffffff;\n      padding: 10px;\n      cursor: pointer;\n      background-color: transparent;\n    }\n  }\n  @media (max-width: 700px) {\n    padding: 10px 30px;\n  }\n`;\nconst Nav = styled.nav`\n  display: flex;\n  align-items: center;\n  > a {\n    color: #ffffff;\n    margin-left: 30px;\n    &.selected {\n      border-bottom: 1px solid #ffffff;\n    }\n  }\n`;\nconst Logo = styled.img`\n  height: 50px;\n`;\n\nconst Header: React.FC = observer(() => {\n  const {UserStore, AuthStore} = useStores();\n  const handleLogOut = () => {\n    AuthStore.logOut();\n    HistoryStore.reset();\n  };\n  return (\n    <HeaderWrapper>\n      <Nav>\n        <Logo src={logo} />\n        <NavLink to=\"/\" activeClassName=\"selected\" exact>\n          首页\n        </NavLink>\n        <NavLink to=\"/history\" activeClassName=\"selected\">\n          上传历史\n        </NavLink>\n        <NavLink to=\"/about\" activeClassName=\"selected\">\n          关于\n        </NavLink>\n      </Nav>\n      {UserStore.currentUser ? (\n        <div>\n          <span>用户：{UserStore.currentUser.getUsername()}</span>\n          <button onClick={handleLogOut}>注销</button>\n        </div>\n      ) : (\n        <div>\n          <NavLink to=\"/signIn\">登录</NavLink>\n          <NavLink to=\"/signUp\">注册</NavLink>\n        </div>\n      )}\n    </HeaderWrapper>\n  );\n});\n\nexport {Header};\n","import styled from 'styled-components';\n\nconst FooterWrapper = styled.footer`\n  padding: 10px 100px;\n  text-align: center;\n  margin: 0 auto;\n`;\n\nconst Footer: React.FC = () => {\n  return <FooterWrapper>--我是底线--</FooterWrapper>;\n};\n\nexport {Footer};\n","const Loading: React.FC = () => {\n  return <>Loading...</>;\n};\n\nexport {Loading};\n","import React, {lazy, Suspense} from 'react';\nimport {Switch, Route} from 'react-router-dom';\nimport {Header} from 'components/Header';\nimport {Footer} from 'components/Footer';\nimport {Loading} from 'components/Loading';\nimport styled from 'styled-components';\n\nconst Home = lazy(() => import('pages/Home'));\nconst History = lazy(() => import('pages/History'));\nconst About = lazy(() => import('pages/About'));\nconst SignIn = lazy(() => import('pages/SignIn'));\nconst SignUp = lazy(() => import('pages/SignUp'));\n// import Home from 'pages/Home';\n// import History from 'pages/History';\n// import About from 'pages/About';\nconst Main = styled.main`\n  flex-grow: 1;\n  padding: 10px 100px;\n`;\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n`;\n\nfunction App() {\n  return (\n    <Wrapper>\n      <Header />\n      <Main>\n        <Suspense fallback={<Loading />}>\n          <Switch>\n            <Route path=\"/\" exact component={Home} />\n            <Route path=\"/history\" exact component={History} />\n            <Route path=\"/about\" exact component={About} />\n            <Route path=\"/signIn\" exact component={SignIn} />\n            <Route path=\"/signUp\" exact component={SignUp} />\n          </Switch>\n        </Suspense>\n      </Main>\n      <Footer />\n    </Wrapper>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport {HashRouter as Router} from 'react-router-dom';\nimport App from './App';\n\nReactDOM.render(\n  <Router>\n    <App />\n  </Router>,\n  document.getElementById('root')\n);\n","import AV, {User} from 'leancloud-storage';\nimport config from 'config';\n\nAV.init({\n  ...config.leancloud,\n});\n\nconsole.log('models: start....');\n\nconst AuthModels = {\n  signUp(username: string, password: string) {\n    const user = new User();\n    user.setUsername(username);\n    user.setPassword(password);\n    return new Promise((resolve, reject) => {\n      user.signUp().then(\n        signInUser => {\n          console.log('sign up success...');\n          resolve(signInUser);\n        },\n        error => {\n          console.log('sign up error......');\n          reject(error);\n        }\n      );\n    });\n  },\n  signIn(username: string, password: string) {\n    return new Promise((resolve, reject) => {\n      User.logIn(username, password).then(\n        signInUser => {\n          console.log('sign in success...');\n          resolve(signInUser);\n        },\n        error => {\n          console.log('sign up error......');\n          reject(error);\n        }\n      );\n    });\n  },\n  logOut: () => {\n    User.logOut();\n  },\n  getCurrentUser: () => {\n    return User.current();\n  },\n};\n\nconst UploadModels = {\n  add(file: File, filename: string, username: string | undefined) {\n    const item = new AV.Object('Image');\n    const avFile = new AV.File(filename, file);\n    item.set('filename', filename);\n    item.set('owner', AV.User.current());\n    item.set('url', avFile);\n    return new Promise((resolve, reject) => {\n      item.save().then(\n        serverFile => {\n          console.log('保存成功');\n          const reader = new FileReader();\n          reader.readAsDataURL(file);\n          reader.onload = () => {\n            const str = reader.result;\n            if (typeof str === 'string') {\n              const baseStr = str?.slice(str.indexOf(',') + 1, str.length);\n              console.log(baseStr);\n              uploadGithub(serverFile.id, baseStr, username);\n              resolve(serverFile);\n            }\n          };\n        },\n        e => {\n          console.log('保存失败');\n          reject(e);\n        }\n      );\n    });\n  },\n  find({page = 0, limit = 10}): Promise<AV.Queriable[]> {\n    const query = new AV.Query('Image');\n    query.include('owner');\n    query.limit(limit);\n    query.skip(page * limit);\n    query.descending('createdAt');\n    query.equalTo('owner', AV.User.current());\n    return new Promise((resolve, reject) => {\n      query\n        .find()\n        .then(results => resolve(results))\n        .catch(error => reject(error));\n    });\n  },\n};\nfunction uploadGithub(name: string | undefined, dataImage: string, username: string | undefined) {\n  const data = JSON.stringify({\n    message: `${username}：${name}`,\n    content: dataImage,\n  });\n  fetch(`https://solitary-union-ab10.limkk.workers.dev/upload-image?fileId=${name}`, {\n    body: data,\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json',\n    },\n  })\n    .then(response => {\n      console.log(response);\n    })\n    .catch(err => {\n      console.error(err);\n    });\n}\n\nexport {AuthModels, UploadModels};\n","const config = {\n  imageUrl: 'https://image.versionlin.xyz/',\n  leancloud: {\n    appId: 'Ad46YKbNw2plrBhsEIeGHoqP-gzGzoHsz',\n    appKey: 'vXDbKIsxXI3B3q9DNL6dS5uk',\n    serverURL: 'https://uqbaasqm.lc-cn-n1-shared.com',\n  },\n};\nexport default config;\n","import {makeAutoObservable} from 'mobx';\nimport AV from 'leancloud-storage';\nimport {UploadModels} from 'models';\nimport {message} from 'antd';\nimport config from 'config';\n\ntype UploadFile = {\n  id: number;\n  fileId: string | undefined;\n  filename: string;\n  url: string;\n};\n\ntype History = {\n  list: UploadFile[];\n  isLoading: boolean;\n  hasMore: boolean;\n  page: number;\n  limit: number;\n  append: (Y: AV.Queriable[]) => void;\n  find: () => void;\n  reset: () => void;\n};\n\nconst historyStore: History = {\n  list: [],\n  isLoading: false,\n  hasMore: true,\n  page: 0,\n  limit: 10,\n\n  append(newList) {\n    this.list = this.list.concat(\n      newList.map((x, idx) => ({\n        id: idx,\n        fileId: x.id,\n        filename: x.get('filename'),\n        url: `${config.imageUrl}${x.id}.png`,\n      }))\n    );\n  },\n\n  find() {\n    this.isLoading = true;\n    UploadModels.find({page: this.page, limit: this.limit})\n      .then(newList => {\n        console.log(newList);\n        this.append(newList);\n        this.page++;\n        if (newList.length < this.limit) {\n          this.hasMore = false;\n        }\n      })\n      .catch(error => {\n        message.error('加载数据失败');\n      })\n      .finally(() => {\n        this.isLoading = false;\n      });\n  },\n\n  reset() {\n    this.list = [];\n    this.isLoading = false;\n    this.hasMore = true;\n    this.page = 0;\n  },\n};\n\nconst HistoryStore = makeAutoObservable(historyStore);\nexport {HistoryStore};\n","import {User} from 'leancloud-storage';\nimport {makeAutoObservable} from 'mobx';\nimport {AuthModels} from 'models';\n\ntype Store = {\n  currentUser: User | null;\n  setCurrentUser: () => void;\n};\n\nconst store: Store = {\n  currentUser: AuthModels.getCurrentUser(),\n  setCurrentUser() {\n    this.currentUser = AuthModels.getCurrentUser();\n  },\n};\n\nconst UserStore = makeAutoObservable(store);\nexport {UserStore};\n","import {message} from 'antd';\nimport {makeAutoObservable} from 'mobx';\nimport {UploadModels} from 'models';\nimport config from 'config';\nimport {UserStore} from './user';\n\ntype UploadFile = {\n  fileId: string | undefined;\n  filename: string;\n  url: string;\n};\n\ntype Store = {\n  filename: string;\n  file: File | null;\n  isUploading: boolean;\n  serverFile: null | UploadFile;\n  setFilename: (x: string) => void;\n  setFile: (x: File | null) => void;\n  upload: () => Promise<UploadFile> | Promise<void>;\n  // find: () => void;\n};\n\nconst store: Store = {\n  filename: '',\n  file: null,\n  isUploading: false,\n  serverFile: null,\n\n  setFilename(newFilename) {\n    this.filename = newFilename;\n  },\n  setFile(newFile) {\n    this.file = newFile;\n  },\n  upload() {\n    if (!this.file) return Promise.resolve();\n    this.isUploading = true;\n    this.serverFile = null;\n    return UploadModels.add(this.file, this.filename, UserStore.currentUser?.getUsername())\n      .then(\n        (serverFile: any) => {\n          console.log(serverFile);\n          this.serverFile = {\n            fileId: serverFile.id,\n            url: `${config.imageUrl}${serverFile.id}.png`,\n            filename: serverFile.get('filename'),\n          };\n          return this.serverFile;\n        },\n        e => {\n          message.error('上传失败');\n          return Promise.reject(e);\n        }\n      )\n      .finally(() => (this.isUploading = false));\n  },\n};\n\nconst ImageStore = makeAutoObservable(store);\nexport {ImageStore};\n","import {message} from 'antd';\nimport {makeAutoObservable, runInAction} from 'mobx';\nimport {AuthModels} from 'models';\nimport {ImageStore} from './image';\nimport {UserStore} from './user';\n\n// class Store {\n//   isSignIn = false;\n//   isLoading = false;\n//   values = {\n//     username: '',\n//     password: '123',\n//   };\n//   constructor() {\n//     makeAutoObservable(this);\n//   }\n\n//   setIsSignIn(isSignIn: boolean) {\n//     this.isSignIn = isSignIn;\n//   }\n//   setUsername(username: string) {\n//     this.values.username = username;\n//   }\n//   setPassword(passWord: string) {\n//     this.values.password = passWord;\n//   }\n//   signIn() {\n//     console.log('登录中...');\n//     this.isLoading = true;\n//     setTimeout(() => {\n//       console.log('登录成功');\n//       this.isSignIn = true;\n//       this.isLoading = false;\n//     }, 1000);\n//   }\n//   register() {\n//     console.log('注册中...');\n//     this.isLoading = true;\n//     setTimeout(() => {\n//       console.log('注册成功');\n//       runInAction(() => {\n//         this.isSignIn = false;\n//         this.isLoading = false;\n//       });\n//     }, 1000);\n//   }\n//   logout() {\n//     console.log('已注销');\n//   }\n// }\n// const AuthStore = new Store();\n\nconst store = {\n  isSignIn: false,\n  isLoading: false,\n  values: {\n    username: '',\n    password: '',\n  },\n\n  setIsSignIn(isSignIn: boolean) {\n    this.isSignIn = isSignIn;\n  },\n  setUsername(username: string) {\n    this.values.username = username;\n  },\n  setPassword(passWord: string) {\n    this.values.password = passWord;\n  },\n  signIn() {\n    console.log('authStore: 登录中...');\n    this.isLoading = true;\n    return new Promise((resolve, reject) => {\n      AuthModels.signIn(this.values.username, this.values.password)\n        .then(user => {\n          console.log('authStore: 登录成功', user);\n          runInAction(() => {\n            UserStore.setCurrentUser();\n            console.log('authStore:', UserStore.currentUser);\n            console.log('authStore: sign in runInAction');\n            this.isSignIn = true;\n            this.isLoading = false;\n          });\n          resolve(user);\n        })\n        .catch(err => {\n          message.error(`登录失败: ${err.message}`);\n          reject(err);\n        });\n    });\n  },\n  signUp() {\n    console.log('authStore: 注册中...');\n    this.isLoading = true;\n    return new Promise((resolve, reject) => {\n      AuthModels.signUp(this.values.username, this.values.password).then(\n        user => {\n          console.log('authStore: 注册成功', user);\n          runInAction(() => {\n            UserStore.setCurrentUser();\n            console.log('authStore:', UserStore.currentUser);\n            console.log('authStore: sign up runInAction');\n            this.isSignIn = false;\n            this.isLoading = false;\n          });\n          resolve(user);\n        },\n        err => {\n          message.error(`注册失败: ${err.message}`);\n          reject(err);\n        }\n      );\n    });\n  },\n  logOut() {\n    AuthModels.logOut();\n    UserStore.setCurrentUser();\n    ImageStore.serverFile = null;\n  },\n};\nconst AuthStore = makeAutoObservable(store);\nexport {AuthStore};\n","import {createContext, useContext} from 'react';\nimport {AuthStore} from './auth';\nimport {HistoryStore} from './history';\nimport {ImageStore} from './image';\nimport {UserStore} from './user';\n\nconst defaultValue = {\n  AuthStore,\n  UserStore,\n  ImageStore,\n  HistoryStore,\n};\n\nconst Context = createContext(defaultValue);\n\nconst useStores = () => useContext(Context);\n\nexport {useStores};\n"],"sourceRoot":""}